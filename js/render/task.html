<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <p class="count">1</p>
    <div>
      <button class="add">点我</button>
    </div>
  </body>
  <script>
    let $count = document.querySelector('.count')
    let $btn = document.querySelector('.add')
    let count = 1

    function sleep(times = 0) {
      let start = new Date()
      let end = new Date()
      while (end - start < times) {
        end = new Date()
      }
    }

    $btn.addEventListener('click', () => {
      // alert('task正在执行...')
      count++
      $count.textContent = count
      console.log('before data:', count)
      console.log('before fef:', $count.textContent)
      sleep(10000)

      Promise.resolve().then(() => {
        alert('micro-task正在执行...')
        count++
        $count.textContent = count
        sleep(1000)
        console.log('after data:', count)
        console.log('after fef:', $count.textContent)
      })

      setTimeout(() => {
        alert('next-task正在执行...')
        count++
        $count.textContent = count
        sleep(1000)
        console.log('next data:', count)
        console.log('next fef:', $count.textContent)
      })
    })
  </script>
</html>
